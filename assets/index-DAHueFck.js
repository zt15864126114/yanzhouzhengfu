import{d as Z,a as B,r as g,D as ee,c as te,b as n,e as t,w as a,f as u,t as V,j as i,g as v,a2 as le,_ as q,a3 as ae,a4 as se,a5 as ne,$ as oe,i as de,m as ue,J as ie,M as I,E as R,o as M}from"./index-DZf3JEl4.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"backup-container"},pe={class:"backup-stats new-style"},me={class:"stat-card2 total"},fe={class:"icon-block"},_e={class:"stat-content"},ge={class:"stat-value"},ve={class:"stat-trend up"},ye={class:"stat-card2 running"},be={class:"icon-block"},ke={class:"stat-content"},we={class:"stat-value"},he={class:"stat-trend up"},Ve={class:"stat-card2 completed"},xe={class:"icon-block"},Ce={class:"stat-content"},Te={class:"stat-value"},Re={class:"stat-trend up"},Ue={class:"stat-card2 failed"},Be={class:"icon-block"},qe={class:"stat-content"},Se={class:"stat-value"},ze={class:"stat-trend down"},Ee={class:"operation-bar"},$e={class:"pagination"},De=Z({__name:"index",setup(Fe){const m=B({total:0,running:0,completed:0,failed:0}),r=g([{id:1,name:"数据库全量备份",owner:"李明",type:"full",source:"/data/mysql",target:"/backup/mysql/full",schedule:"daily",status:"completed",progress:100,lastRunTime:"2025-04-01 02:00",desc:"每日凌晨全量备份"},{id:2,name:"文件服务器增量备份",owner:"王芳",type:"incremental",source:"/data/files",target:"/backup/files/incremental",schedule:"weekly",status:"running",progress:45,lastRunTime:"2025-04-01 03:00",desc:"文件服务器每周增量备份"},{id:3,name:"应用系统差异备份",owner:"赵强",type:"differential",source:"/data/apps",target:"/backup/apps/differential",schedule:"monthly",status:"failed",progress:60,lastRunTime:"2025-04-01 04:00",desc:"应用系统每月差异备份"},{id:4,name:"配置文件备份",owner:"孙丽",type:"full",source:"/etc",target:"/backup/config",schedule:"daily",status:"waiting",progress:0,lastRunTime:"2025-03-31 02:00",desc:"系统配置文件每日全量备份"},{id:5,name:"日志文件备份",owner:"周伟",type:"incremental",source:"/var/log",target:"/backup/logs",schedule:"weekly",status:"completed",progress:100,lastRunTime:"2025-03-31 03:00",desc:"日志文件每周增量备份"}]),S=g([]),f=B({keyword:""}),k=g(1),x=g(10),z=g(0),w=g(!1),C=g("add"),U=g(),s=B({id:0,name:"",owner:"",type:"full",source:"",target:"",schedule:"daily",status:"waiting",progress:0,lastRunTime:"",desc:"",customTime:""}),N={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],owner:[{required:!0,message:"请输入负责人",trigger:"blur"}],type:[{required:!0,message:"请选择备份类型",trigger:"change"}],source:[{required:!0,message:"请输入源路径",trigger:"blur"}],target:[{required:!0,message:"请输入目标路径",trigger:"blur"}],schedule:[{required:!0,message:"请选择执行计划",trigger:"change"}],desc:[{required:!0,message:"请输入描述",trigger:"blur"}],customTime:[{required:!0,message:"请选择自定义时间",trigger:"change"}]};function T(){m.total=r.value.length,m.running=r.value.filter(o=>o.status==="running").length,m.completed=r.value.filter(o=>o.status==="completed").length,m.failed=r.value.filter(o=>o.status==="failed").length}function c(){let o=[...r.value];f.keyword&&(o=o.filter(e=>e.name.includes(f.keyword)||e.owner.includes(f.keyword)||e.target.includes(f.keyword))),z.value=o.length,S.value=o.slice((k.value-1)*x.value,k.value*x.value)}function j(){f.keyword="",k.value=1,c()}function H(){C.value="add",w.value=!0,s.id=0,s.name="",s.owner="",s.type="full",s.source="",s.target="",s.schedule="daily",s.status="waiting",s.progress=0,s.lastRunTime="",s.desc="",s.customTime=""}function K(o){C.value="edit",w.value=!0,Object.assign(s,o)}function L(o){I.confirm("确定要删除该备份任务吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=r.value.findIndex(d=>d.id===o.id);e!==-1&&(r.value.splice(e,1),c(),T(),R.success("删除成功"))})}function P(o){I.confirm("确定要立即执行该备份任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{const e=r.value.findIndex(d=>d.id===o.id);e!==-1&&(r.value[e].status="running",r.value[e].progress=0,c(),T(),R.success("任务已开始执行"))})}function A(){U.value&&U.value.validate(o=>{if(o){if(C.value==="add"){const e={...s,id:Date.now()};r.value.unshift(e),c(),T(),R.success("新增成功")}else{const e=r.value.findIndex(d=>d.id===s.id);e!==-1&&(r.value[e]={...s},c(),R.success("修改成功"))}w.value=!1}})}function J(o){x.value=o,c()}function O(o){k.value=o,c()}return ee(()=>{c(),T()}),(o,e)=>{const d=u("el-icon"),h=u("el-input"),p=u("el-form-item"),_=u("el-button"),E=u("el-form"),y=u("el-table-column"),$=u("el-tag"),G=u("el-table"),Q=u("el-pagination"),W=u("el-card"),b=u("el-option"),D=u("el-select"),X=u("el-time-picker"),Y=u("el-dialog");return M(),te("div",ce,[n("div",pe,[n("div",me,[n("div",fe,[t(d,null,{default:a(()=>[t(v(le))]),_:1})]),n("div",_e,[e[14]||(e[14]=n("div",{class:"stat-title"},"总任务数",-1)),n("div",ge,V(m.total),1),n("div",ve,[t(d,null,{default:a(()=>[t(v(q))]),_:1}),e[13]||(e[13]=i(" 0% "))])])]),n("div",ye,[n("div",be,[t(d,null,{default:a(()=>[t(v(ae))]),_:1})]),n("div",ke,[e[16]||(e[16]=n("div",{class:"stat-title"},"运行中",-1)),n("div",we,V(m.running),1),n("div",he,[t(d,null,{default:a(()=>[t(v(q))]),_:1}),e[15]||(e[15]=i(" 0% "))])])]),n("div",Ve,[n("div",xe,[t(d,null,{default:a(()=>[t(v(se))]),_:1})]),n("div",Ce,[e[18]||(e[18]=n("div",{class:"stat-title"},"已完成",-1)),n("div",Te,V(m.completed),1),n("div",Re,[t(d,null,{default:a(()=>[t(v(q))]),_:1}),e[17]||(e[17]=i(" 0% "))])])]),n("div",Ue,[n("div",Be,[t(d,null,{default:a(()=>[t(v(ne))]),_:1})]),n("div",qe,[e[20]||(e[20]=n("div",{class:"stat-title"},"失败",-1)),n("div",Se,V(m.failed),1),n("div",ze,[t(d,null,{default:a(()=>[t(v(oe))]),_:1}),e[19]||(e[19]=i(" 0% "))])])])]),n("div",Ee,[t(E,{inline:!0,model:f,class:"search-form"},{default:a(()=>[t(p,null,{default:a(()=>[t(h,{modelValue:f.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>f.keyword=l),placeholder:"任务名称/负责人/目标路径",clearable:"",onKeyup:de(c,["enter"])},null,8,["modelValue"])]),_:1}),t(p,null,{default:a(()=>[t(_,{type:"primary",onClick:c},{default:a(()=>e[21]||(e[21]=[i("搜索")])),_:1,__:[21]}),t(_,{onClick:j},{default:a(()=>e[22]||(e[22]=[i("重置")])),_:1,__:[22]})]),_:1})]),_:1},8,["model"]),t(_,{type:"primary",onClick:H},{default:a(()=>e[23]||(e[23]=[i("新建备份任务")])),_:1,__:[23]})]),t(W,{class:"backup-list",shadow:"hover"},{default:a(()=>[t(G,{data:S.value,border:"",style:{width:"100%"}},{default:a(()=>[t(y,{prop:"name",label:"任务名称","min-width":"140"}),t(y,{prop:"owner",label:"负责人","min-width":"100"}),t(y,{prop:"type",label:"类型","min-width":"100"},{default:a(({row:l})=>[t($,{type:l.type==="full"?"primary":l.type==="incremental"?"success":"warning"},{default:a(()=>[i(V(l.type==="full"?"全量备份":l.type==="incremental"?"增量备份":"差异备份"),1)]),_:2},1032,["type"])]),_:1}),t(y,{prop:"status",label:"状态","min-width":"100"},{default:a(({row:l})=>[t($,{type:l.status==="running"?"primary":l.status==="completed"?"success":l.status==="failed"?"danger":"info"},{default:a(()=>[i(V(l.status==="running"?"运行中":l.status==="completed"?"已完成":l.status==="failed"?"失败":"等待中"),1)]),_:2},1032,["type"])]),_:1}),t(y,{prop:"lastRunTime",label:"备份时间","min-width":"160"}),t(y,{prop:"desc",label:"描述","min-width":"180","show-overflow-tooltip":""}),t(y,{label:"操作",width:"200"},{default:a(({row:l})=>[t(_,{type:"primary",link:"",onClick:F=>P(l),disabled:l.status==="running"},{default:a(()=>e[24]||(e[24]=[i("执行")])),_:2,__:[24]},1032,["onClick","disabled"]),t(_,{type:"primary",link:"",onClick:F=>K(l)},{default:a(()=>e[25]||(e[25]=[i("编辑")])),_:2,__:[25]},1032,["onClick"]),t(_,{type:"danger",link:"",onClick:F=>L(l)},{default:a(()=>e[26]||(e[26]=[i("删除")])),_:2,__:[26]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),n("div",$e,[t(Q,{"current-page":k.value,"onUpdate:currentPage":e[1]||(e[1]=l=>k.value=l),"page-size":x.value,"onUpdate:pageSize":e[2]||(e[2]=l=>x.value=l),"page-sizes":[10,20,50,100],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:O},null,8,["current-page","page-size","total"])])]),_:1}),t(Y,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=l=>w.value=l),title:C.value==="add"?"新建备份任务":"编辑备份任务",width:"600px"},{footer:a(()=>[t(_,{onClick:e[11]||(e[11]=l=>w.value=!1)},{default:a(()=>e[27]||(e[27]=[i("取消")])),_:1,__:[27]}),t(_,{type:"primary",onClick:A},{default:a(()=>e[28]||(e[28]=[i("确定")])),_:1,__:[28]})]),default:a(()=>[t(E,{ref_key:"backupFormRef",ref:U,model:s,rules:N,"label-width":"100px"},{default:a(()=>[t(p,{label:"任务名称",prop:"name"},{default:a(()=>[t(h,{modelValue:s.name,"onUpdate:modelValue":e[3]||(e[3]=l=>s.name=l),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),t(p,{label:"负责人",prop:"owner"},{default:a(()=>[t(h,{modelValue:s.owner,"onUpdate:modelValue":e[4]||(e[4]=l=>s.owner=l),placeholder:"请输入负责人"},null,8,["modelValue"])]),_:1}),t(p,{label:"类型",prop:"type"},{default:a(()=>[t(D,{modelValue:s.type,"onUpdate:modelValue":e[5]||(e[5]=l=>s.type=l),placeholder:"请选择备份类型",style:{width:"100%"}},{default:a(()=>[t(b,{label:"全量备份",value:"full"}),t(b,{label:"增量备份",value:"incremental"}),t(b,{label:"差异备份",value:"differential"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"源路径",prop:"source"},{default:a(()=>[t(h,{modelValue:s.source,"onUpdate:modelValue":e[6]||(e[6]=l=>s.source=l),placeholder:"请输入源路径"},null,8,["modelValue"])]),_:1}),t(p,{label:"目标路径",prop:"target"},{default:a(()=>[t(h,{modelValue:s.target,"onUpdate:modelValue":e[7]||(e[7]=l=>s.target=l),placeholder:"请输入目标路径"},null,8,["modelValue"])]),_:1}),t(p,{label:"执行计划",prop:"schedule"},{default:a(()=>[t(D,{modelValue:s.schedule,"onUpdate:modelValue":e[8]||(e[8]=l=>s.schedule=l),placeholder:"请选择执行计划",style:{width:"100%"}},{default:a(()=>[t(b,{label:"每天",value:"daily"}),t(b,{label:"每周",value:"weekly"}),t(b,{label:"每月",value:"monthly"}),t(b,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),s.schedule==="custom"?(M(),ue(p,{key:0,label:"自定义时间",prop:"customTime"},{default:a(()=>[t(X,{modelValue:s.customTime,"onUpdate:modelValue":e[9]||(e[9]=l=>s.customTime=l),format:"HH:mm",placeholder:"选择时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):ie("",!0),t(p,{label:"描述",prop:"desc"},{default:a(()=>[t(h,{modelValue:s.desc,"onUpdate:modelValue":e[10]||(e[10]=l=>s.desc=l),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ne=re(De,[["__scopeId","data-v-56ccadca"]]);export{Ne as default};
